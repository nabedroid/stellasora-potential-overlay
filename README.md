# ステラソラ素質オーバーレイ

ゲームウィンドウを1秒ごとにキャプチャし、素質カード選択で対象のカードにメッセージを表示する。

## 必要な環境

- Windows 10/11 (64bit)
- Docker Desktop (ビルド時のみ)

## ビルド方法

`build.bat` を実行します。

## 使い方

### 初回設定

1. `StellasoraPotentialOverlay.exe` を実行します
2. 「探索準備」ボタンをクリックします
3. 対象の素質を追加します

#### 探索準備の設定

「探索準備」で対象の素質を設定します。

1. 「主力」のキャラクターを選択します
1. 対象の素質の有効チェックボックスをオンにします
1. 必要に応じて目標、メモを入力します
1. 「支援1」、「支援2」について同様の設定を行います
1. 「保存」ボタンをクリックします

### 認識の開始

1. ゲームを起動します
1. 「開始」ボタンをクリックします
1. ゲームウィンドウ上に認識結果が表示されます:
   - 目標レベル
   - メモ（設定されている場合）
1. 停止する場合は「停止」ボタンをクリックします

### デバッグモード

OCR領域と認識された文字を確認したい場合:

1. 「設定」→「認識設定」タブ
1. 「デバッグモード（OCR領域と認識文字を表示）」にチェック
1. 「保存」をクリック
1. 「開始」ボタンをクリック

デバッグモードでは以下が表示されます:
- **OCR領域**: シアン色の枠線と半透明の塗りつぶし
- **認識された文字**: 各領域の下部に黄色で表示（認識なしの場合は「[認識なし]」）

デバッグモードは領域の位置調整や認識精度の確認に便利です。

### その他設定
設定からOCR領域等の詳細な設定を行えます。
デフォルトは微調整した値ですので、変更は非推奨です。
どうしてもうまく認識しない場合は、デバッグで確認しながら微調整してください。

#### キャプチャ間隔
画面をキャプチャしてOCRを実行する間隔を指定できます。
デフォルトは1秒です。

#### 色閾値
画像の二値化を行い、文字の輪郭を明確にします。
閾値は文字として残す暗さの判定に使われます。
閾値が高いと文字が太くなりますが、背景のノイズも拾いやすくなります。
閾値が低いとノイズは減りますが、文字が細くなったり、かすれたりしやすくなります。

#### OCR領域の設定
読み取るエリアを指定できます。
各値は画面比率で指定します。
素質選択時、コア素質、サブ素質で縦位置が異なるため注意してください。

- **Y座標**: 読み取るエリアの上端
- **幅**: 読み取るエリアの幅
- **高さ**: 読み取るエリアの高さ
- **左側X**: 左側のカードの左端
- **中央X**: 中央のカードの左端
- **右側X**: 右側のカードの左端

## 設定ファイル

設定は `config.json` に保存されます。このファイルは `StellasoraPotentialOverlay.exe` と同じディレクトリに作成されます。

## 技術スタック

- **C# + WPF**: UIフレームワーク
- **Windows.Media.Ocr API**: 日本語OCR認識
- **.NET 8**: ランタイム
- **Docker**: ビルド環境

## トラブルシューティング

### OCRエンジンの初期化に失敗する

- Windows 10/11であることを確認してください
- 日本語言語パックがインストールされているか確認してください
  - 設定 → 時刻と言語 → 言語 → 日本語

### オーバーレイが表示されない

- 対象ウィンドウが正しく選択されているか確認してください
- ゲームウィンドウが最小化されていないか確認してください

## ライセンス

MIT License

## 注意事項

- OCR領域にエフェクトが発生すると認識が不安定になる可能性があります
- ゲームウィンドウが最小化されている場合は認識できません
- 1秒ごとの認識処理のため、CPU使用率が上昇する可能性があります

# TODO
- プリセットを用意して素質の選択を楽にしたい
- github のリリースを更新する場合
  - git add .
  - git commit -m "update"
  - git push
  - git tag v9.9.9
  - git push origin v9.9.9