# ステラソラ素質オーバーレイ

ゲームウィンドウを1秒ごとにキャプチャし、素質カード選択で対象のカードにメッセージを表示します。

## 必要な環境

- Windows 10/11 (64bit)
- Docker Desktop (ビルド時のみ)

## ビルド方法

`build.bat` を実行します。

## 使い方

### 初回設定

1. `StellasoraPotentialOverlay.exe` を実行します
2. 「設定」ボタンをクリックします
3. 文字検索設定を追加します

#### OCR領域の設定（非推奨）

「OCR領域共通設定」で読み取るエリアを指定できます。
各値は画面比率で指定します。

- **Y座標**: 読み取るエリアの上端
- **幅**: 読み取るエリアの幅
- **高さ**: 読み取るエリアの高さ
- **左側X**: 左側のカードの左端
- **中央X**: 中央のカードの左端
- **右側X**: 右側のカードの左端

#### 文字検索の設定

「文字検索設定」タブで検索対象の文字を設定します:

1. 「文字を追加」ボタンをクリック
2. 検索文字を入力（認識させたい文字）
3. 目標レベルを選択（「取得のみ」「レベル1」「レベル1～」「レベル6」など）
4. メモを入力（自由記述）
5. 表示色を設定（ARGB形式、例: #FFFFFF00）
6. 「保存」ボタンをクリック

### 認識の開始

1. ゲームを起動します
2. 「開始」ボタンをクリックします
3. ゲームウィンドウ上に認識結果が表示されます:
   - 目標レベル
   - メモ（設定されている場合）
4. 停止する場合は「停止」ボタンをクリックします

### デバッグモード

OCR領域と認識された文字を確認したい場合:

1. 「設定」→「認識設定」タブ
2. 「デバッグモード（OCR領域と認識文字を表示）」にチェック
3. 「保存」をクリック
4. 「開始」ボタンをクリック

デバッグモードでは以下が表示されます:
- **OCR領域**: シアン色の枠線と半透明の塗りつぶし
- **認識された文字**: 各領域の下部に黄色で表示（認識なしの場合は「[認識なし]」）

デバッグモードは領域の位置調整や認識精度の確認に便利です。

## 設定ファイル

設定は `config.json` に保存されます。このファイルは `StellasoraPotentialOverlay.exe` と同じディレクトリに作成されます。

## 技術スタック

- **C# + WPF**: UIフレームワーク
- **Windows.Media.Ocr API**: 日本語OCR認識
- **.NET 8**: ランタイム
- **Docker**: ビルド環境

## トラブルシューティング

### OCRエンジンの初期化に失敗する

- Windows 10/11であることを確認してください
- 日本語言語パックがインストールされているか確認してください
  - 設定 → 時刻と言語 → 言語 → 日本語

### 文字が正しく認識されない

- OCR領域が正しく設定されているか確認してください
- ゲームのフォントや背景色によって認識精度が変わります

### オーバーレイが表示されない

- 対象ウィンドウが正しく選択されているか確認してください
- ゲームウィンドウが最小化されていないか確認してください

## ライセンス

MIT License

## 注意事項

- OCR認識精度はゲームのフォントや背景色に依存します
- ゲームウィンドウが最小化されている場合は認識できません
- 1秒ごとの認識処理のため、CPU使用率が上昇する可能性があります

# TODO
- コア素質を認識しない
  - コア素質の名前の位置がサブ素質と異なるため
    - もしかしたらサブ素質も異なる位置かもしれない
- 文字認識の精度を上げる
  - 読み取る範囲を狭めてみる
    - カード全体を読み取ると認識が不安定
  - 二値化やスケールを変更してみたが特に変わらず
    - むしろ下がった
- 素質選択時にカード位置が上にずれる問題に対応する
  - 暫定対応として、通常時と選択時の両方をカバーする範囲を指定してる
    - さらに上下に2分割して、それぞれを読み取るようにしている
      - 両方一気に読み取ると精度が落ちるので
        - おそらくレベルの背景色が灰色の影響
- いちいち検索対象の文字を打ち込むのは面倒なので選択式にしたい
  - プリセットも必要かも
- UI をもう少し綺麗にする
  - せめてボタンのサイズを一定にする
- ビルドを精査する
  - bat にまとめられないか？
  - コンテナ側で処理した方がいいか？
  - リリース、デバッグをうまく切り替えられないか
    - 現状は build.ps1 の変数で切り替えている
- 使っていない変数や処理が点在している
  - 生成されたコードをいじくりまわしたので
  - 二値化やスケールの処理
  - 非同期関連の処理
    - ビルド時に警告されてる
- ステラソラを起動していない状態で設定を開くと対象ウィンドウが空になる
  - ウィンドウのリストにStellaSoraが存在しないので
  - 面倒なので StellaSora 固定でいい気がする
